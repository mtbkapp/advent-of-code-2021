<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1" name="viewport"><link href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" rel="stylesheet" type="text/css"><link href="https://storage.googleapis.com/nextjournal-cas-eu/data/8VxQBDwk3cvr1bt8YVL5m6bJGrFEmzrSbCrH1roypLjJr4AbbteCKh9Y6gQVYexdY85QA2HG5nQFLWpRp69zFSPDJ9" rel="stylesheet" type="text/css"><link href="https://storage.googleapis.com/nextjournal-cas-eu/data/8VxoxUgsBRs2yjjBBcfeCc8XigM7erXHmjJg2tjdGxNBxwTYuDonuYswXqRStaCA2b3rTEPCgPwixJmAVrea1qAHHU" rel="stylesheet" type="text/css"><script src="https://storage.googleapis.com/nextjournal-cas-eu/data/8VujAQ3bHzgNYiC3C61DJwUmXP7xW6bB8tT92xAKhDyu5vXReakaHVSrqJfurggZdCJVuAf3B7AujNBvkJAcz974uH" type="text/javascript"></script></head><body><div id="clerk"></div><script>let viewer = nextjournal.clerk.sci_viewer
let doc = "{:nextjournal/value [{:nextjournal/value \"# [Day 15](https://adventofcode.com/2021/day/15)\\n\", :nextjournal/viewer :markdown} {:nextjournal/value \"(ns advent-of-code-2021.day15\\n  (:require [clojure.java.io :as io]\\n            [clojure.set :as sets]\\n            [clojure.string :as string]\\n            [nextjournal.clerk :as clerk]\\n            [nextjournal.clerk.viewer :as v]\\n            [ubergraph.core :as uber]\\n            [ubergraph.alg :as ualg]))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value nil, :nextjournal/viewer {:pred #function+ \\\"ojure.core$nil_QMARK_ 0x2670435 \\\\\\\"clojure.core$nil_QMARK_@2670435\\\\\\\"\\\", :fn #function+ (fn [_] (v/html [:span.syntax-nil.inspected-value \\\"nil\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(def real-input (slurp (io/resource \\\"day15.txt\\\")))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value [\\\"6919598227838199913855119231126554696792992136695118448313191841922775524417825151216891429923213541\\\" {:nextjournal/value {:path [], :count 10100, :offset 100, :remaining 10000}, :nextjournal/viewer :elision}], :replace-path [0], :nextjournal/viewer {:pred #function+ \\\"ojure.core$string_QMARK___5427 0x3704122f \\\\\\\"clojure.core$string_QMARK___5427@3704122f\\\\\\\"\\\", :fn #function+ v/string-viewer, :fetch-opts {:n 100}}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(def test-input\\n  \\\"1163751742\\n1381373672\\n2136511328\\n3694931569\\n7463417111\\n1319128137\\n1359912421\\n3125421639\\n1293138521\\n2311944581\\\")\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value [\\\"1163751742\\\\n1381373672\\\\n2136511328\\\\n3694931569\\\\n7463417111\\\\n1319128137\\\\n1359912421\\\\n3125421639\\\\n1293138521\\\\n2\\\" {:nextjournal/value {:path [], :count 109, :offset 100, :remaining 9}, :nextjournal/viewer :elision}], :replace-path [0], :nextjournal/viewer {:pred #function+ \\\"ojure.core$string_QMARK___5427 0x3704122f \\\\\\\"clojure.core$string_QMARK___5427@3704122f\\\\\\\"\\\", :fn #function+ v/string-viewer, :fetch-opts {:n 100}}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn read-input\\n  [input]\\n  (let [m (mapv #(mapv (fn [c](Long/valueOf (str c))) %)\\n                (string/split-lines input))]\\n    {:m m\\n     :size (count m)}))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$read_input 0x2c663d23 \\\\\\\"advent_of_code_2021.day15$read_input@2c663d23\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \" ## Part 1\\n For this one I decided to try to hit the easy button by using the \\n [ubergraph library](https://github.com/Engelberg/ubergraph). Then I modeled\\n the risk map into a graph where each location in the map is a node and there\\n are edges between each location and it's adjacent locations (up, down, left, \\n right). The weights of the edges into a location it's risk level from the map.\\n Then just use the algorithm in ubergraph to find the shortest path and the\\n cost of that path.\\n\", :nextjournal/viewer :markdown} {:nextjournal/value \" Look vector addition again...\\n\", :nextjournal/viewer :markdown} {:nextjournal/value \"(defn vec+\\n  [[x0 y0] [x1 y1]]\\n  [(+ x0 x1) (+ y0 y1)])\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$vec_PLUS_ 0x32cdb22f \\\\\\\"advent_of_code_2021.day15$vec_PLUS_@32cdb22f\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn points-in-square\\n  [size]\\n  (for [y (range size)\\n        x (range size)]\\n    [x y]))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$points_in_square 0x53d43bcd \\\\\\\"advent_of_code_2021.day15$points_in_square@53d43bcd\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn adjacent\\n  [[x y :as n] size]\\n  (for [dv [[-1 0] [1 0] [0 -1] [0 1]]\\n        :let [[nx ny :as nn] (vec+ n dv)]\\n        :when (and (< -1 nx size)\\n                   (< -1 ny size))]\\n    nn))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$adjacent 0x4b7ce208 \\\\\\\"advent_of_code_2021.day15$adjacent@4b7ce208\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn build-edges\\n  [{:keys [m size] :as input} nodes]\\n  (mapcat (fn [[x y :as n]]\\n            (map (fn [adj]\\n                   [adj n (get-in m [y x])])\\n                 (adjacent n size)))\\n          nodes))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$build_edges 0x566e5161 \\\\\\\"advent_of_code_2021.day15$build_edges@566e5161\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn build-graph\\n  [{:keys [m size] :as input}]\\n  (let [nodes (points-in-square size)]\\n    (as-> (uber/digraph) $\\n      (apply uber/add-nodes $ nodes)\\n      (apply uber/add-edges $ (build-edges input nodes)))))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$build_graph 0x96dcd49 \\\\\\\"advent_of_code_2021.day15$build_graph@96dcd49\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn solve-part1\\n  [{:keys [size] :as input}]\\n  (-> (build-graph input)\\n      (ualg/shortest-path [0 0] [(dec size) (dec size)] :weight)\\n      (ualg/cost-of-path)))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$solve_part1 0x7b1595fa \\\\\\\"advent_of_code_2021.day15$solve_part1@7b1595fa\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(solve-part1 (read-input test-input))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value 40, :nextjournal/viewer {:pred #function+ \\\"ojure.core$number_QMARK_ 0x2c7fb24c \\\\\\\"clojure.core$number_QMARK_@2c7fb24c\\\\\\\"\\\", :fn #function+ (fn [x] (v/html [:span.syntax-number.inspected-value (if (js/Number.isNaN x) \\\"NaN\\\" (str x))]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(solve-part1 (read-input real-input))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value 458, :nextjournal/viewer {:pred #function+ \\\"ojure.core$number_QMARK_ 0x2c7fb24c \\\\\\\"clojure.core$number_QMARK_@2c7fb24c\\\\\\\"\\\", :fn #function+ (fn [x] (v/html [:span.syntax-number.inspected-value (if (js/Number.isNaN x) \\\"NaN\\\" (str x))]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \" ## Part 2\\n I think I got lucky after the polymerization and lantern fish ones because\\n the same algorithm still works in Part 2. It's slow but it completes in a\\n reasonable amount of time. Just need to expand the map as the puzzle explains.\\n\", :nextjournal/viewer :markdown} {:nextjournal/value \"(defn risk+\\n  [r x]\\n  (inc (mod (dec (+ r x)) 9)))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$risk_PLUS_ 0x57555432 \\\\\\\"advent_of_code_2021.day15$risk_PLUS_@57555432\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn build-tile\\n  [m size [tx ty]]\\n  (let [dr (+ tx ty)]\\n    (reduce (fn [nm [x y]]\\n              (update-in nm [y x] risk+ dr))\\n            m\\n            (points-in-square size))))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$build_tile 0x7394e2e0 \\\\\\\"advent_of_code_2021.day15$build_tile@7394e2e0\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn blank-map \\n  [size]\\n  (vec (repeat size (vec (repeat size nil)))))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$blank_map 0x14f46e5e \\\\\\\"advent_of_code_2021.day15$blank_map@14f46e5e\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn combine-tiles\\n  [tiles tile-size]\\n  (reduce (fn [m [x y]]\\n            (let [in-tile-x (mod x tile-size)\\n                  in-tile-y (mod y tile-size)\\n                  tile-x (quot x tile-size)\\n                  tile-y (quot y tile-size)\\n                  risk-in-tile (get-in tiles \\n                                       [[tile-x tile-y] in-tile-y in-tile-x])]\\n              (assoc-in m [y x] risk-in-tile)))\\n          (blank-map (* tile-size 5))\\n          (points-in-square (* tile-size 5))))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$combine_tiles 0x4399937f \\\\\\\"advent_of_code_2021.day15$combine_tiles@4399937f\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn expand-map\\n  [m size]\\n  (-> (into {}\\n            (map #(vector % (build-tile m size %)))\\n            (points-in-square 5))\\n      (combine-tiles size)))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$expand_map 0x3e90bbfa \\\\\\\"advent_of_code_2021.day15$expand_map@3e90bbfa\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn init-part2\\n  [{:keys [m size] :as input}]\\n  {:m (expand-map m size)\\n   :size (* size 5)})\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$init_part2 0x6ac7dd2a \\\\\\\"advent_of_code_2021.day15$init_part2@6ac7dd2a\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(defn solve-part2\\n  [input]\\n  (solve-part1 (init-part2 input)))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value \\\"vent_of_code_2021.day15$solve_part2 0x5df6d8b2 \\\\\\\"advent_of_code_2021.day15$solve_part2@5df6d8b2\\\\\\\"\\\", :nextjournal/viewer {:pred #function+ \\\"ojure.core$fn_QMARK_ 0x64e6f678 \\\\\\\"clojure.core$fn_QMARK_@64e6f678\\\\\\\"\\\", :name :fn, :fn #function+ (fn [x] (v/html [:span.inspected-value [:span.syntax-tag \\\"#function\\\"] \\\"[\\\" x \\\"]\\\"]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(solve-part2 (read-input test-input))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value 315, :nextjournal/viewer {:pred #function+ \\\"ojure.core$number_QMARK_ 0x2c7fb24c \\\\\\\"clojure.core$number_QMARK_@2c7fb24c\\\\\\\"\\\", :fn #function+ (fn [x] (v/html [:span.syntax-number.inspected-value (if (js/Number.isNaN x) \\\"NaN\\\" (str x))]))}}\"}, :nextjournal/viewer :clerk/inline-result} {:nextjournal/value \"(solve-part2 (read-input real-input))\", :nextjournal/viewer :code} {:nextjournal/value {:edn \"{:path [], :nextjournal/value 2800, :nextjournal/viewer {:pred #function+ \\\"ojure.core$number_QMARK_ 0x2c7fb24c \\\\\\\"clojure.core$number_QMARK_@2c7fb24c\\\\\\\"\\\", :fn #function+ (fn [x] (v/html [:span.syntax-number.inspected-value (if (js/Number.isNaN x) \\\"NaN\\\" (str x))]))}}\"}, :nextjournal/viewer :clerk/inline-result}], :nextjournal/viewer :clerk/notebook, :scope {:namespace :advent-of-code-2021.day15}}"
viewer.reset_doc(viewer.read_string(doc))
viewer.mount(document.getElementById('clerk'))
</script></body></html>